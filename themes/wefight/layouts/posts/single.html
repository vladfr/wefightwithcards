{{ partial "head.html" . }}

{{ partial "topbar.html" . }}

{{ partial "header.html" . }}

{{ if .Params.Image }}
<div class="hero is-black is-medium" style="
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0),rgba(0, 0, 0, 0.6)),
    url('{{ .Params.Image }}') no-repeat 50%; background-size: cover">
    <div class="hero-body"></div>
    <div class="hero-foot" style="margin-bottom: 40px">
        <div class="container has-text-centered">
            <p class="small">{{ .Date.Format "Jan _2" }}</p>

            <h1 class="title">
                {{ .Title }}
            </h1>
            {{ with .Params.Subtitle }}
                <h2 class="subtitle">{{ . }}</h2>
            {{ end }}
        </div>
    </div>
</div>

{{ else }}

<section class="section">

    <div class="container">
        <p class="small">{{ .Date.Format "Jan _2" }}</p>

        <h1 class="title">
            {{ .Title }}
        </h1>
        {{ with .Params.Subtitle }}
            <h2 class="subtitle">{{ . }}</h2>
        {{ end }}
    </div>
</section>

{{ end }}

<section class="section post-content">
    <div class="container">
        {{ .Content }}
    </div>
</section>

<section class="section">
    <div class="container" id="comments">

    </div>
</section>

<form id="commentform" action="" method="post">
    <input name="author" />
    <textarea name="comment"></textarea>
    <button type="submit">Send comment</button>
</form>

{{ if .Params.Reddit }}
<section class="section">
    <div class="container">
        <p>
            <a href="{{ .Params.Reddit }}">See the reddit thread</a>
        </p>
        <script type="text/javascript" src="{{ .Params.Reddit }}.embed"></script>
    </div>
</section>
{{ end }}

{{ partial "footer.html" . }}


<script>
    jQuery.getJSON('http://statikit-scripts.s3-website-us-east-1.amazonaws.com/test.json', function (data) {
        jQuery.each(data, function(index, data){
            jQuery('#comments').append('<div><p>'+data.author+'</p><p>'+data.comment+'</p></div>');
        });
    });

    jQuery('#commentform').submit(function(e) {
        e.preventDefault();
        data = $('form#myForm').serialize();
        payload = {
            "TableName": "statikit-test",
            "Item": {
                "account": {"S": "test"},
                "author": {"S": data['author']},
                "email": {"S": "email@asd.com"},
                "date": {"S": "2015-07-24"},
                "comment": {"S": data['comment']}
            }
        };
        jQuery.ajax({
            url: 'https://a225djb29i.execute-api.us-east-1.amazonaws.com/prod/statikit-comments-test',
            type: 'post',
            data: payload,
            headers: {
                'x-api-key': 'E4sYgjCr5u63NvvDhCq2x4GqyrS6qYMw1moiH2nr'
            },
            dataType: 'json',
            success: function (data) {
                console.log(data);
            }
        });
    });
</script>